let currentLanguage="id";function applyTranslations(){document.querySelectorAll("[data-translate]").forEach(e=>{let t=e.getAttribute("data-translate");translations[currentLanguage]&&translations[currentLanguage][t]&&(e.textContent=translations[currentLanguage][t])})}async function detectUserLanguage(){try{let e=await fetch("https://ipapi.co/json/"),t=await e.json();currentLanguage="ID"===t.country?"id":"en"}catch(e){console.warn("Failed to detect user location, defaulting to Indonesian:",e),currentLanguage="id"}}const initialData=[{modul:"A",kategori:"ELEKTRONIK",komponen:"Mikrokontroler (e.g., Arduino Uno)",jumlah:1,satuan:"unit",harga:15e4,keterangan:"Otak utama proyek",isHeader:!1,image:""},{modul:"A",kategori:"ELEKTRONIK",komponen:"Sensor Jarak (e.g., HC-SR04)",jumlah:2,satuan:"unit",harga:25e3,keterangan:"Untuk deteksi halangan",isHeader:!1,image:""},{modul:"B",kategori:"MEKANIK",komponen:"Roda Karet",jumlah:4,satuan:"pcs",harga:15e3,keterangan:"Ukuran 65mm",isHeader:!1,image:""},{modul:"B",kategori:"MEKANIK",komponen:"Motor DC + Gearbox",jumlah:4,satuan:"unit",harga:45e3,keterangan:"Penggerak roda",isHeader:!1,image:""},{modul:"C",kategori:"DAYA",komponen:"Baterai Li-Ion 18650",jumlah:2,satuan:"unit",harga:5e4,keterangan:"Kapasitas 3000mAh",isHeader:!1,image:""},{modul:"C",kategori:"DAYA",komponen:"Modul Charger TP4056",jumlah:1,satuan:"unit",harga:1e4,keterangan:"Untuk mengisi daya baterai",isHeader:!1,image:""}],rabTbody=document.getElementById("rab-tbody"),rabTitle=document.getElementById("rab-title"),addRowBtn=document.getElementById("add-row-btn"),undoBtn=document.getElementById("undo-btn"),redoBtn=document.getElementById("redo-btn"),actionDropdownToggle=document.getElementById("action-dropdown-toggle"),actionDropdownMenu=document.getElementById("action-dropdown-menu"),importJsonBtn=document.getElementById("import-json-btn"),exportJsonBtn=document.getElementById("export-json-btn"),printPdfBtn=document.getElementById("print-pdf-btn");let history=[],historyIndex=-1;function formatRupiah(e){return new Intl.NumberFormat("id-ID",{maximumFractionDigits:0}).format(e)}function createRow(e){if(e.isHeader){let t=document.createElement("tr");t.className="modul-header",t.innerHTML=`
            <td colspan="10" contenteditable="true">${e.modul} - ${e.kategori}</td>
            <td class="action-column">
                <button class="add-component-header-btn" data-modul="${e.modul}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus-circle"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg>
                </button>
            </td>
        `;let a=t.querySelector(".add-component-header-btn");return a&&a.addEventListener("click",e=>{addComponentToModule(e.currentTarget.dataset.modul)}),t}let t=document.createElement("tr");t.className=`modul-${e.modul.toLowerCase()}`,t.dataset.modul=e.modul,t.innerHTML=`
        <td data-label="Modul" class="center-print editable-cell" contenteditable="true">${e.modul}</td>
        <td data-label="Kategori" class="editable-cell" contenteditable="true">${e.kategori}</td>
        <td data-label="Komponen" class="editable-cell" contenteditable="true">${e.komponen}</td>
        
        <td data-label="Jumlah" class="center-print">
            <input type="number" min="0" value="${e.jumlah}" class="qty-input">
            <span class="print-text">${e.jumlah}</span>
        </td>
        
        <td data-label="Satuan" class="editable-cell" contenteditable="true">${e.satuan}</td>
        
        <td data-label="Harga Satuan (IDR)">
            <input type="number" min="0" value="${e.harga}" class="price-input">
            <span class="print-text">${formatRupiah(e.harga)}</span>
        </td>
        
        <td data-label="Subtotal (IDR)" class="currency subtotal"></td>
        <td data-label="Keterangan" class="note editable-cell" contenteditable="true">${e.keterangan}</td>
        
        <td data-label="Gambar" class="image-column">
            <div class="image-preview-container">
                <img src="${e.image||"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="}" class="image-preview" alt="Gambar Komponen" ${e.image?"":'style="display: none;"'}>
                <input type="file" accept="image/*" class="image-input" style="display: none;">
                <div class="image-controls">
                    <button class="btn-image-upload">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                    </button>
                    <button class="btn-image-clear" ${e.image?"":'style="display: none;"'}>
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x-circle"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>
                    </button>
                </div>
            </div>
        </td>
        
        <td data-label="Aksi" class="action-column"><button class="delete-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
        </button></td> 
    `;let a=t.querySelector(".qty-input"),n=t.querySelector(".price-input"),r=t.querySelector(".delete-btn"),o=t.querySelectorAll(".editable-cell"),l=t.querySelector(".image-input"),i=t.querySelector(".image-preview"),d=t.querySelector(".btn-image-upload"),s=t.querySelector(".btn-image-clear"),c=t.querySelector(".print-text:first-child"),u=t.querySelector(".print-text:last-child");return a.addEventListener("input",()=>{calculateTotal(),c.textContent=a.value}),n.addEventListener("input",()=>{calculateTotal(),u.textContent=formatRupiah(n.value)}),a.addEventListener("blur",()=>saveState()),n.addEventListener("blur",()=>saveState()),r.addEventListener("click",e=>deleteRow(e.target)),o.forEach(e=>{e.addEventListener("input",calculateTotal),e.addEventListener("blur",()=>saveState())}),d.addEventListener("click",()=>l.click()),l.addEventListener("change",e=>{let a=e.target.files[0];if(a){let e=new FileReader;e.onload=e=>{i.src=e.target.result,i.style.display="block",s.style.display="inline-block";let a=extractTableData();Array.from(rabTbody.children).indexOf(t);let n=-1,r=0;for(let e=0;e<rabTbody.children.length;e++)if(!rabTbody.children[e].classList.contains("modul-header")){if(rabTbody.children[e]===t){n=r;break}r++}-1!==n&&a[n]&&(a[n].image=e.target.result,saveState())},e.readAsDataURL(a)}}),s.addEventListener("click",()=>{i.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",i.style.display="none",s.style.display="none";let e=extractTableData();Array.from(rabTbody.children).indexOf(t);let a=-1,n=0;for(let e=0;e<rabTbody.children.length;e++)if(!rabTbody.children[e].classList.contains("modul-header")){if(rabTbody.children[e]===t){a=n;break}n++}-1!==a&&e[a]&&(e[a].image="",saveState())}),t}function insertTotalRow(){let e=document.querySelector(".total-row-dynamic");e&&e.remove();let t=document.createElement("tr");t.className="total-row total-row-dynamic",t.innerHTML=`
        <td colspan="6" style="text-align: center;">TOTAL KESELURUHAN (ESTIMASI)</td>
        <td class="currency" id="total-harga">0</td>
        <td colspan="3" class="action-column"></td> 
        `,rabTbody.appendChild(t)}function updateUndoRedoButtons(){undoBtn.disabled=historyIndex<=0,redoBtn.disabled=historyIndex>=history.length-1}function saveState(){let e=extractTableData();historyIndex<history.length-1&&(history=history.slice(0,historyIndex+1)),history.push(e),historyIndex++,updateUndoRedoButtons()}function undo(){historyIndex>0&&(renderTable(history[--historyIndex],!1),updateUndoRedoButtons())}function redo(){historyIndex<history.length-1&&(renderTable(history[++historyIndex],!1),updateUndoRedoButtons())}function renderTable(e,t=!0){rabTbody.innerHTML="";let a=null;e.sort((e,t)=>e.modul.localeCompare(t.modul)),e.forEach(e=>{let t=e.kategori;if(e.modul!==a){let n={modul:e.modul,kategori:t,isHeader:!0};rabTbody.appendChild(createRow(n)),a=e.modul}rabTbody.appendChild(createRow(e))}),insertTotalRow(),calculateTotal(),t&&saveState()}function calculateTotal(e=!1){let t=0;rabTbody.querySelectorAll("tr:not(.modul-header):not(.total-row-dynamic)").forEach(e=>{let a=e.querySelector(".qty-input"),n=e.querySelector(".price-input"),r=e.querySelector(".subtotal"),o=(parseInt(a?a.value:0)||0)*(parseInt(n?n.value:0)||0);r&&(r.textContent=formatRupiah(o),t+=o)});let a=document.getElementById("total-harga"),n=document.getElementById("total-estimasi");a&&(a.textContent=formatRupiah(t)),n&&(n.textContent="Rp "+formatRupiah(t)),e&&saveState()}function addComponentToModule(e){let t=extractTableData(),a=t.length;for(let n=t.length-1;n>=0;n--)if(t[n].modul===e){a=n+1;break}t.splice(a,0,{modul:e,kategori:"KATEGORI BARU",komponen:"Komponen Baru",jumlah:1,satuan:"pcs",harga:1e4,keterangan:"Masukkan keterangan di sini",isHeader:!1,image:""}),renderTable(t)}function addNewRow(){let e=extractTableData();e.push({modul:"E",kategori:"KOMPONEN LAIN",komponen:"Komponen Baru",jumlah:1,satuan:"pcs",harga:1e4,keterangan:"Masukkan keterangan di sini",isHeader:!1,image:""}),renderTable(e)}function deleteRow(e){let t=e.closest("tr"),a=t.children[2].textContent;confirm(`Yakin ingin menghapus komponen: ${a}?`)&&(t.remove(),calculateTotal(),saveState())}function extractTableData(){let e=[];return rabTbody.querySelectorAll("tr:not(.modul-header):not(.total-row-dynamic)").forEach(t=>{let a=t.querySelector(".image-preview"),n=a&&"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="!==a.src?a.src:"",r={modul:t.children[0].textContent.trim(),kategori:t.children[1].textContent.trim(),komponen:t.children[2].textContent.trim(),jumlah:parseInt(t.querySelector(".qty-input").value)||0,satuan:t.children[4].textContent.trim(),harga:parseInt(t.querySelector(".price-input").value)||0,keterangan:t.children[7].textContent.trim(),image:n,isHeader:!1};e.push(r)}),e}function exportData(){let e=new Blob([JSON.stringify({title:rabTitle.textContent,data:extractTableData()},null,2)],{type:"application/json"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=`${rabTitle.textContent.replace(/\s/g,"_")}_RAB.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),alert("Data RAB berhasil diexport sebagai JSON.")}function importData(e){try{let t=JSON.parse(e);rabTitle.textContent=t.title||"RAB Maker Interaktif",renderTable(t.data),alert("Data RAB berhasil diimport.")}catch(e){alert("Gagal mengimport data. Pastikan file JSON valid."),console.error("Import Error:",e)}}const importFileInput=document.createElement("input");importFileInput.type="file",importFileInput.accept=".json",importFileInput.style.display="none";const handleImportFileChange=e=>{let t=e.target.files[0];if(t){let e=new FileReader;e.onload=e=>importData(e.target.result),e.readAsText(t)}};function triggerImportFileInput(){importFileInput.click()}document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("theme-toggle"),t=t=>{"dark"===t?(document.body.classList.add("dark-mode"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>'):(document.body.classList.remove("dark-mode"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>')};t(localStorage.getItem("theme")||"dark"),document.body.appendChild(importFileInput),importFileInput.addEventListener("change",handleImportFileChange),e.addEventListener("click",()=>{let e=document.body.classList.contains("dark-mode")?"light":"dark";localStorage.setItem("theme",e),t(e)}),addRowBtn.addEventListener("click",addNewRow),undoBtn.addEventListener("click",undo),redoBtn.addEventListener("click",redo);let a=document.getElementById("language-id"),n=document.getElementById("language-en");function r(){"id"===currentLanguage?(a.classList.add("active"),n.classList.remove("active")):(n.classList.add("active"),a.classList.remove("active"))}a.addEventListener("click",()=>{currentLanguage="id",applyTranslations(),r()}),n.addEventListener("click",()=>{currentLanguage="en",applyTranslations(),r()}),actionDropdownToggle.addEventListener("click",e=>{e.stopPropagation(),actionDropdownMenu.classList.toggle("show")}),document.addEventListener("click",e=>{actionDropdownMenu.contains(e.target)||actionDropdownToggle.contains(e.target)||actionDropdownMenu.classList.remove("show")}),importJsonBtn.addEventListener("click",triggerImportFileInput),exportJsonBtn.addEventListener("click",exportData),printPdfBtn.addEventListener("click",()=>window.print()),document.addEventListener("keydown",e=>{document.activeElement.isContentEditable||"INPUT"===document.activeElement.tagName||document.activeElement.tagName,e.ctrlKey&&"z"===e.key&&(e.preventDefault(),undo()),e.ctrlKey&&"y"===e.key&&(e.preventDefault(),redo())}),detectUserLanguage().then(()=>{applyTranslations(),r()}),renderTable(initialData,!0),updateUndoRedoButtons()});
//# sourceMappingURL=RAB-maker.5b0186a1.js.map
